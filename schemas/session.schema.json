{
  "$id": "https://github.com/Davidmctf/agents-promps/tree/main/schemas/session.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "additionalProperties": false,
  "description": "Schema for validating chat session state, history, and persistent memory",
  "examples": [
    {
      "$schema": "../../schemas/session.schema.json",
      "context": {
        "activeFiles": [
          "src/main.ts",
          "src/utils.ts"
        ],
        "contextSize": 2500,
        "projectName": "my-project",
        "workspacePath": "/workspace/my-project"
      },
      "created": "2025-10-15T09:00:00Z",
      "flags": {
        "hasErrors": false,
        "isArchived": false,
        "isPersistent": true
      },
      "history": {
        "messages": [
          {
            "content": "Refactor the authentication system",
            "id": "msg-001",
            "role": "user",
            "timestamp": "2025-10-15T09:00:00Z"
          },
          {
            "agent": "orchestratorAgent",
            "content": "I'll coordinate a multi-step refactoring...",
            "id": "msg-002",
            "role": "assistant",
            "timestamp": "2025-10-15T09:00:15Z",
            "toolCalls": [
              {
                "id": "tool-001",
                "parameters": {
                  "path": "src/auth"
                },
                "result": {
                  "complexity": "high"
                },
                "tool": "analyze_codebase"
              }
            ]
          }
        ],
        "retentionLimit": 100,
        "totalMessages": 2
      },
      "metrics": {
        "completedTasks": 1,
        "failedTasks": 0,
        "messageCount": 2,
        "taskCount": 1,
        "toolCallCount": 1
      },
      "mode": {
        "agent": "orchestratorAgent",
        "id": "agent-orchestrator",
        "name": "Agent Orchestrator",
        "profile": "collaborative"
      },
      "sessionId": "550e8400-e29b-41d4-a716-446655440000",
      "tasks": [
        {
          "agent": "orchestratorAgent",
          "completed": "2025-10-15T09:05:00Z",
          "created": "2025-10-15T09:00:00Z",
          "description": "Analyze authentication codebase",
          "id": "task-001",
          "priority": "high",
          "result": {
            "output": "Analysis complete",
            "success": true
          },
          "status": "completed"
        }
      ],
      "updated": "2025-10-15T10:30:00Z",
      "version": "1.0.0"
    }
  ],
  "properties": {
    "$schema": {
      "description": "Reference to this schema for validation",
      "type": "string"
    },
    "context": {
      "description": "Session context information",
      "properties": {
        "activeFiles": {
          "description": "Files currently in context",
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "contextSize": {
          "description": "Current context size in tokens",
          "type": "integer"
        },
        "projectName": {
          "description": "Project name",
          "type": "string"
        },
        "workspacePath": {
          "description": "Current workspace path",
          "type": "string"
        }
      },
      "type": "object"
    },
    "created": {
      "description": "Session creation timestamp",
      "format": "date-time",
      "type": "string"
    },
    "decisions": {
      "description": "Important decisions made during session",
      "items": {
        "properties": {
          "agent": {
            "description": "Agent that made this decision",
            "type": "string"
          },
          "alternatives": {
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "decision": {
            "type": "string"
          },
          "id": {
            "type": "string"
          },
          "impact": {
            "enum": [
              "low",
              "medium",
              "high",
              "critical"
            ],
            "type": "string"
          },
          "rationale": {
            "type": "string"
          },
          "timestamp": {
            "format": "date-time",
            "type": "string"
          },
          "type": {
            "enum": [
              "architecture",
              "implementation",
              "tooling",
              "approach"
            ],
            "type": "string"
          }
        },
        "required": [
          "id",
          "timestamp",
          "decision"
        ],
        "type": "object"
      },
      "type": "array"
    },
    "flags": {
      "description": "Session flags",
      "properties": {
        "hasErrors": {
          "description": "Whether session has unresolved errors",
          "type": "boolean"
        },
        "isArchived": {
          "description": "Whether session is archived",
          "type": "boolean"
        },
        "isPersistent": {
          "description": "Whether this session should be saved",
          "type": "boolean"
        },
        "needsReview": {
          "description": "Whether session needs human review",
          "type": "boolean"
        }
      },
      "type": "object"
    },
    "history": {
      "description": "Conversation history",
      "properties": {
        "messages": {
          "description": "Conversation message history",
          "items": {
            "properties": {
              "agent": {
                "description": "Agent that generated this message (for assistant role)",
                "type": "string"
              },
              "content": {
                "description": "Message content",
                "type": "string"
              },
              "id": {
                "description": "Unique message ID",
                "type": "string"
              },
              "metadata": {
                "additionalProperties": true,
                "description": "Additional message metadata",
                "type": "object"
              },
              "role": {
                "description": "Message role",
                "enum": [
                  "user",
                  "assistant",
                  "system"
                ],
                "type": "string"
              },
              "timestamp": {
                "description": "When message was sent",
                "format": "date-time",
                "type": "string"
              },
              "toolCalls": {
                "description": "Tools called during this message",
                "items": {
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "parameters": {
                      "type": "object"
                    },
                    "result": {
                      "type": "object"
                    },
                    "tool": {
                      "type": "string"
                    }
                  },
                  "type": "object"
                },
                "type": "array"
              }
            },
            "required": [
              "id",
              "role",
              "content",
              "timestamp"
            ],
            "type": "object"
          },
          "type": "array"
        },
        "retentionLimit": {
          "description": "Maximum messages to retain",
          "type": "integer"
        },
        "totalMessages": {
          "description": "Total message count",
          "type": "integer"
        }
      },
      "type": "object"
    },
    "issues": {
      "description": "Issues encountered during session",
      "items": {
        "properties": {
          "category": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "id": {
            "type": "string"
          },
          "resolution": {
            "type": "string"
          },
          "resolved": {
            "type": "boolean"
          },
          "resolvedAt": {
            "format": "date-time",
            "type": "string"
          },
          "severity": {
            "enum": [
              "info",
              "warning",
              "error",
              "critical"
            ],
            "type": "string"
          },
          "timestamp": {
            "format": "date-time",
            "type": "string"
          }
        },
        "required": [
          "id",
          "timestamp",
          "severity",
          "description"
        ],
        "type": "object"
      },
      "type": "array"
    },
    "memory": {
      "description": "Persistent memory and learned information",
      "properties": {
        "facts": {
          "description": "Learned facts about user, project, or context",
          "items": {
            "properties": {
              "confidence": {
                "description": "Confidence level (0-1)",
                "maximum": 1,
                "minimum": 0,
                "type": "number"
              },
              "fact": {
                "description": "Learned fact or information",
                "type": "string"
              },
              "id": {
                "type": "string"
              },
              "source": {
                "description": "Message ID or source of this fact",
                "type": "string"
              },
              "timestamp": {
                "format": "date-time",
                "type": "string"
              }
            },
            "type": "object"
          },
          "type": "array"
        },
        "patterns": {
          "description": "Observed patterns in user behavior or requests",
          "items": {
            "properties": {
              "frequency": {
                "description": "How often observed",
                "type": "integer"
              },
              "pattern": {
                "description": "Observed pattern",
                "type": "string"
              }
            },
            "type": "object"
          },
          "type": "array"
        },
        "preferences": {
          "additionalProperties": true,
          "description": "User preferences learned during session",
          "type": "object"
        }
      },
      "type": "object"
    },
    "metadata": {
      "additionalProperties": true,
      "description": "Additional session metadata",
      "properties": {
        "environment": {
          "description": "Environment (VS Code, CLI, etc.)",
          "type": "string"
        },
        "platform": {
          "description": "Platform (Copilot, Claude, etc.)",
          "type": "string"
        },
        "tags": {
          "description": "Session tags",
          "items": {
            "type": "string"
          },
          "type": "array"
        }
      },
      "type": "object"
    },
    "metrics": {
      "description": "Session metrics and statistics",
      "properties": {
        "averageResponseTime": {
          "description": "Average response time in milliseconds",
          "type": "number"
        },
        "completedTasks": {
          "description": "Tasks completed successfully",
          "type": "integer"
        },
        "contextSwitches": {
          "description": "Number of mode/agent switches",
          "type": "integer"
        },
        "failedTasks": {
          "description": "Tasks that failed",
          "type": "integer"
        },
        "messageCount": {
          "description": "Total messages exchanged",
          "type": "integer"
        },
        "taskCount": {
          "description": "Total tasks created",
          "type": "integer"
        },
        "toolCallCount": {
          "description": "Total tool calls made",
          "type": "integer"
        }
      },
      "type": "object"
    },
    "mode": {
      "description": "Current chat mode configuration",
      "properties": {
        "agent": {
          "description": "Active agent ID",
          "type": "string"
        },
        "id": {
          "description": "Active chat mode ID",
          "type": "string"
        },
        "name": {
          "description": "Chat mode name",
          "type": "string"
        },
        "profile": {
          "description": "Active profile",
          "type": "string"
        }
      },
      "type": "object"
    },
    "sessionId": {
      "description": "Unique identifier for this session",
      "format": "uuid",
      "type": "string"
    },
    "tasks": {
      "description": "Tasks executed or queued in this session",
      "items": {
        "properties": {
          "agent": {
            "description": "Agent handling this task",
            "type": "string"
          },
          "checkpoint": {
            "description": "Checkpoint data for resuming interrupted tasks",
            "properties": {
              "canResume": {
                "type": "boolean"
              },
              "state": {
                "additionalProperties": true,
                "type": "object"
              },
              "step": {
                "type": "integer"
              },
              "totalSteps": {
                "type": "integer"
              }
            },
            "type": "object"
          },
          "completed": {
            "format": "date-time",
            "type": "string"
          },
          "created": {
            "format": "date-time",
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "id": {
            "type": "string"
          },
          "priority": {
            "enum": [
              "low",
              "medium",
              "high",
              "critical"
            ],
            "type": "string"
          },
          "result": {
            "properties": {
              "error": {
                "type": "string"
              },
              "output": {
                "type": "string"
              },
              "success": {
                "type": "boolean"
              }
            },
            "type": "object"
          },
          "started": {
            "format": "date-time",
            "type": "string"
          },
          "status": {
            "enum": [
              "pending",
              "in-progress",
              "completed",
              "failed",
              "cancelled"
            ],
            "type": "string"
          }
        },
        "required": [
          "id",
          "description",
          "status"
        ],
        "type": "object"
      },
      "type": "array"
    },
    "updated": {
      "description": "Last update timestamp",
      "format": "date-time",
      "type": "string"
    },
    "version": {
      "description": "Session schema version",
      "examples": [
        "1.0.0"
      ],
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "type": "string"
    }
  },
  "required": [
    "sessionId",
    "version",
    "created",
    "updated"
  ],
  "title": "Session Schema",
  "type": "object"
}